import React from "react";
import Head from "@/layout/head/Head";
import Content from "@/layout/content/Content";
import "./VulnerabilityMetrics.css";
import { Badge } from "reactstrap";
import {
  Block,
  BlockHead,
  BlockHeadContent,
  BlockTitle,
  BlockDes,
  BackTo,
  PreviewCard,
  Row,
  Col,
} from "@/components/Component";
import { Line, Bar } from "react-chartjs-2";
import {
  Chart as ChartJS,
  CategoryScale,
  LinearScale,
  PointElement,
  LineElement,
  BarElement,
  Title,
  Tooltip,
  Legend,
} from 'chart.js';

// Register Chart.js components
ChartJS.register(
  CategoryScale,
  LinearScale,
  PointElement,
  LineElement,
  BarElement,
  Title,
  Tooltip,
  Legend
);

const VulnerabilityMetrics = () => {

  // Compact table component for vulnerability metrics
  const VulnerabilityCompactTable = ({ title, data, lastUpdated }) => {
    return (
      <div className="card-inner">
        <div className="card-title-group align-start mb-3">
          <div className="card-title">
            <h6 className="title">{title}</h6>
          </div>
        </div>
        <table className="table table-tranx is-compact">
          <thead>
            <tr className="tb-tnx-head">
              <th className="tb-tnx-id">
                <span className="">&nbsp;</span>
              </th>
              <th className="tb-tnx-info">
                <span className="tb-tnx-desc">
                  <span>LOW</span>
                </span>
              </th>
              <th className="tb-tnx-amount">
                <span className="tb-tnx-total">MEDIUM</span>
              </th>
              <th className="tb-tnx-amount">
                <span className="tb-tnx-total">HIGH</span>
              </th>
              <th className="tb-tnx-amount">
                <span className="tb-tnx-total">CRITICAL</span>
              </th>
            </tr>
          </thead>
          <tbody>
            {data.map((row, idx) => (
              <tr key={idx} className="tb-tnx-item">
                <td className="tb-tnx-id">
                  <span><strong>{row.range}</strong></span>
                </td>
                <td className="tb-tnx-info">
                  <div className="tb-tnx-desc">
                    <Badge className="badge-dot" color="success">
                      {row.low}
                    </Badge>
                  </div>
                </td>
                <td className="tb-tnx-amount">
                  <div className="tb-tnx-total">
                    <Badge className="badge-dot" color="warning">
                      {row.medium}
                    </Badge>
                  </div>
                </td>
                <td className="tb-tnx-amount">
                  <div className="tb-tnx-total">
                    <Badge className="badge-dot" color="danger">
                      {row.high}
                    </Badge>
                  </div>
                </td>
                <td className="tb-tnx-amount">
                  <div className="tb-tnx-total">
                    <Badge className="badge-dot" color="danger">
                      {row.critical}
                    </Badge>
                  </div>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
        <div className="chart-label-group mt-3">
          <div className="chart-label">Last Updated: {lastUpdated}</div>
        </div>
      </div>
    );
  };

  // Compact table component for host listings
  const HostCompactTable = ({ title, data, lastUpdated }) => {
    return (
      <div className="card-inner">
        <div className="card-title-group align-start mb-3">
          <div className="card-title">
            <h6 className="title">{title}</h6>
          </div>
        </div>
        <table className="table table-tranx is-compact">
          <thead>
            <tr className="tb-tnx-head">
              <th className="tb-tnx-info">
                <span className="tb-tnx-desc">
                  <span>IP ADDRESS</span>
                </span>
              </th>
              <th className="tb-tnx-amount">
                <span className="tb-tnx-total">DNS</span>
              </th>
              <th className="tb-tnx-amount">
                <span className="tb-tnx-total">TOTAL</span>
              </th>
              <th className="tb-tnx-amount">
                <span className="tb-tnx-total">VULNERABILITIES</span>
              </th>
            </tr>
          </thead>
          <tbody>
            {data.map((row, idx) => (
              <tr key={idx} className="tb-tnx-item">
                <td className="tb-tnx-info">
                  <div className="tb-tnx-desc">
                    <span className="title">{row.ip}</span>
                  </div>
                </td>
                <td className="tb-tnx-amount">
                  <div className="tb-tnx-total">
                    <span>{row.dns}</span>
                  </div>
                </td>
                <td className="tb-tnx-amount">
                  <div className="tb-tnx-total">
                    <Badge
                      className="badge-dot"
                      color={row.total > 130 ? "danger" : row.total > 100 ? "warning" : "success"}
                    >
                      {row.total}
                    </Badge>
                  </div>
                </td>
                <td className="tb-tnx-amount">
                  <div className="tb-tnx-total">
                    <Badge
                      className="badge-dot"
                      color={row.vulnerabilities > 80 ? "danger" : row.vulnerabilities > 60 ? "warning" : "success"}
                    >
                      {row.vulnerabilities}
                    </Badge>
                  </div>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
        <div className="chart-label-group mt-3">
          <div className="chart-label">Last Updated: {lastUpdated}</div>
        </div>
      </div>
    );
  };

  // Compact table component for vulnerability mitigation (with NEW HOSTS column)
  const VulnerabilityMitigationCompactTable = ({ title, data, lastUpdated }) => {
    return (
      <div className="card-inner">
        <div className="card-title-group align-start mb-3">
          <div className="card-title">
            <h6 className="title">{title}</h6>
          </div>
        </div>
        <table className="table table-tranx is-compact">
          <thead>
            <tr className="tb-tnx-head">
              <th className="tb-tnx-id">
                <span className="">&nbsp;</span>
              </th>
              <th className="tb-tnx-info">
                <span className="tb-tnx-desc">
                  <span>NEW HOSTS</span>
                </span>
              </th>
              <th className="tb-tnx-amount">
                <span className="tb-tnx-total">LOW</span>
              </th>
              <th className="tb-tnx-amount">
                <span className="tb-tnx-total">MEDIUM</span>
              </th>
              <th className="tb-tnx-amount">
                <span className="tb-tnx-total">HIGH</span>
              </th>
              <th className="tb-tnx-amount">
                <span className="tb-tnx-total">CRITICAL</span>
              </th>
            </tr>
          </thead>
          <tbody>
            {data.map((row, idx) => (
              <tr key={idx} className="tb-tnx-item">
                <td className="tb-tnx-id">
                  <span><strong>{row.range}</strong></span>
                </td>
                <td className="tb-tnx-info">
                  <div className="tb-tnx-desc">
                    <Badge className="badge-dot" color="success">
                      {row.newHosts}
                    </Badge>
                  </div>
                </td>
                <td className="tb-tnx-amount">
                  <div className="tb-tnx-total">
                    <Badge className="badge-dot" color="success">
                      {row.low}
                    </Badge>
                  </div>
                </td>
                <td className="tb-tnx-amount">
                  <div className="tb-tnx-total">
                    <Badge className="badge-dot" color="warning">
                      {row.medium}
                    </Badge>
                  </div>
                </td>
                <td className="tb-tnx-amount">
                  <div className="tb-tnx-total">
                    <Badge className="badge-dot" color="danger">
                      {row.high}
                    </Badge>
                  </div>
                </td>
                <td className="tb-tnx-amount">
                  <div className="tb-tnx-total">
                    <Badge className="badge-dot" color="danger">
                      {row.critical}
                    </Badge>
                  </div>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
        <div className="chart-label-group mt-3">
          <div className="chart-label">Last Updated: {lastUpdated}</div>
        </div>
      </div>
    );
  };

  // Mock data for vulnerability trend
  const vulnerabilityTrendData = {
    labels: ['Jan 15', 'Feb 15', 'Mar 15', 'Apr 15', 'May 15', 'Jun 15', 'Jul 15', 'Aug 15', 'Sep 15', 'Oct 15', 'Nov 15', 'Dec 15'],
    datasets: [
      {
        label: 'New',
        data: [12000, 11500, 10800, 9500, 8200, 7800, 7200, 6800, 6500, 6200, 5800, 5500],
        borderColor: '#e85347',
        backgroundColor: 'rgba(232, 83, 71, 0.1)',
        tension: 0.4,
      },
      {
        label: 'Mitigated',
        data: [8000, 8200, 8500, 8800, 9200, 9500, 9800, 10200, 10500, 10800, 11200, 11500],
        borderColor: '#1ee0ac',
        backgroundColor: 'rgba(30, 224, 172, 0.1)',
        tension: 0.4,
      },
      {
        label: 'Previous Mitigated',
        data: [7500, 7800, 8100, 8400, 8700, 9000, 9300, 9600, 9900, 10200, 10500, 10800],
        borderColor: '#816bff',
        backgroundColor: 'rgba(129, 107, 255, 0.1)',
        tension: 0.4,
      }
    ]
  };

  // Mock data for Windows vulnerabilities
  const windowsVulnData = {
    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
    datasets: [
      {
        label: 'Low',
        data: [200, 180, 160, 140, 120, 100, 80, 60, 40, 20, 15, 10],
        backgroundColor: '#1ee0ac',
      },
      {
        label: 'Medium',
        data: [300, 280, 260, 240, 220, 200, 180, 160, 140, 120, 100, 80],
        backgroundColor: '#f4bd0e',
      },
      {
        label: 'High',
        data: [400, 380, 360, 340, 320, 300, 280, 260, 240, 220, 200, 180],
        backgroundColor: '#ff8a00',
      },
      {
        label: 'Critical',
        data: [500, 480, 460, 440, 420, 400, 380, 360, 340, 320, 300, 280],
        backgroundColor: '#e85347',
      }
    ]
  };

  // Mock data for Linux vulnerabilities
  const linuxVulnData = {
    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
    datasets: [
      {
        label: 'Low',
        data: [150, 140, 130, 120, 110, 100, 90, 80, 70, 60, 50, 40],
        backgroundColor: '#1ee0ac',
      },
      {
        label: 'Medium',
        data: [250, 240, 230, 220, 210, 200, 190, 180, 170, 160, 150, 140],
        backgroundColor: '#f4bd0e',
      },
      {
        label: 'High',
        data: [350, 340, 330, 320, 310, 300, 290, 280, 270, 260, 250, 240],
        backgroundColor: '#ff8a00',
      },
      {
        label: 'Critical',
        data: [450, 440, 430, 420, 410, 400, 390, 380, 370, 360, 350, 340],
        backgroundColor: '#e85347',
      }
    ]
  };

  // Chart options
  const lineChartOptions = {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      legend: {
        position: 'bottom',
      },
      title: {
        display: false,
      },
    },
    scales: {
      y: {
        beginAtZero: true,
      },
    },
  };

  const barChartOptions = {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      legend: {
        position: 'bottom',
      },
    },
    scales: {
      x: {
        stacked: true,
      },
      y: {
        stacked: true,
        beginAtZero: true,
      },
    },
  };

  // Mock data for summary tables
  const vulnerabilityAgeData = [
    { range: 'New Hosts', low: 68, medium: 461, high: 1134, critical: 639 },
    { range: 'Less than 30', low: 461, medium: 844, high: 2139, critical: 1639 },
    { range: '30 - 60', low: 763, medium: 1344, high: 3139, critical: 2639 },
    { range: '60 - 90', low: 24, medium: 128, high: 427, critical: 98 },
  ];

  const patchPublicationAge = [
    { range: 'Low', low: 0, medium: 0, high: 0, critical: 0 },
    { range: 'Less than 7', low: 3, medium: 6, high: 15, critical: 32 },
    { range: '7 - 30', low: 7, medium: 14, high: 28, critical: 64 },
    { range: '30 - 90', low: 2, medium: 4, high: 8, critical: 16 },
    { range: 'Greater than 90', low: 1, medium: 2, high: 4, critical: 8 },
  ];

  // Additional data for compact tables
  const vulnerabilityPublicationAge = [
    { range: 'Less than 7', low: 0, medium: 0, high: 0, critical: 0 },
    { range: '7 - 30', low: 3, medium: 6, high: 15, critical: 32 },
    { range: '30 - 90', low: 7, medium: 14, high: 28, critical: 64 },
    { range: 'Greater than 90', low: 2, medium: 4, high: 8, critical: 16 },
  ];

  const vulnerabilityMitigation = [
    { range: 'Less than 30', low: 461, medium: 844, high: 2139, critical: 1639, newHosts: 35 },
    { range: '30 - 60', low: 763, medium: 1344, high: 3139, critical: 2639, newHosts: 67 },
    { range: '60 - 90', low: 24, medium: 128, high: 427, critical: 98, newHosts: 8 },
  ];

  const topVulnerableHosts = [
    { ip: '192.168.1.10', dns: 'web-01', total: 145, vulnerabilities: 92 },
    { ip: '192.168.1.15', dns: 'db-01', total: 132, vulnerabilities: 87 },
    { ip: '192.168.1.20', dns: 'app-01', total: 118, vulnerabilities: 76 },
    { ip: '192.168.1.25', dns: 'mail-01', total: 105, vulnerabilities: 68 },
    { ip: '192.168.1.30', dns: 'file-01', total: 98, vulnerabilities: 62 },
  ];

  const topMitigatedHosts = [
    { ip: '192.168.1.50', dns: 'backup-01', total: 115, vulnerabilities: 89 },
    { ip: '192.168.1.55', dns: 'proxy-01', total: 108, vulnerabilities: 82 },
    { ip: '192.168.1.60', dns: 'monitor-01', total: 95, vulnerabilities: 74 },
    { ip: '192.168.1.65', dns: 'log-01', total: 87, vulnerabilities: 65 },
    { ip: '192.168.1.70', dns: 'test-01', total: 79, vulnerabilities: 58 },
  ];

  return (
    <>
      <Head title="Vulnerability Metrics"></Head>
      <Content>
        <BlockHead size="sm">
          <BlockHeadContent>
            <BackTo link="/vulnerabilities/data" icon="arrow-left">
              Vulnerability Data
            </BackTo>
            <BlockTitle tag="h3" page>
              Executive Vulnerability Metrics
            </BlockTitle>
            <BlockDes className="text-soft">
              <p>Comprehensive vulnerability metrics and analytics dashboard</p>
            </BlockDes>

            {/* Dashboard Controls */}
            <div className="dashboard-switch">
              <button className="btn btn-primary btn-sm">
                <span className="icon ni ni-dashboard"></span>
                Switch Dashboard
              </button>
            </div>
            <div className="options-button">
              <button className="btn btn-outline-light btn-sm">
                <span className="icon ni ni-setting"></span>
                Options
              </button>
            </div>
          </BlockHeadContent>
        </BlockHead>

        <Block>
          <Row className="g-gs">
            {/* Vulnerability Trend Chart */}
            <Col lg="6">
              <PreviewCard>
                <div className="card-inner">
                  <div className="card-title-group align-start mb-3">
                    <div className="card-title">
                      <h6 className="title">Executive Vulnerability Metrics - Vulnerability Trend</h6>
                    </div>
                  </div>
                  <div className="nk-ck" style={{ height: '300px' }}>
                    <Line data={vulnerabilityTrendData} options={lineChartOptions} />
                  </div>
                  <div className="chart-label-group mt-3">
                    <div className="chart-label">Last Updated: 24 minutes ago</div>
                  </div>
                </div>
              </PreviewCard>
            </Col>

            {/* Vulnerability Age Summary */}
            <Col lg="12">
              <PreviewCard>
                <VulnerabilityCompactTable
                  title="Executive Vulnerability Metrics - Vulnerability Publication Age"
                  data={vulnerabilityAgeData}
                  lastUpdated="1 hour ago"
                />
              </PreviewCard>
            </Col>
          </Row>
        </Block>

        {/* Patch Publication Age */}
        <Block>
          <Row className="g-gs">
            <Col lg="12">
              <PreviewCard>
                <VulnerabilityCompactTable
                  title="Executive Vulnerability Metrics - Patch Publication Age"
                  data={patchPublicationAge}
                  lastUpdated="1 hour ago"
                />
              </PreviewCard>
            </Col>
          </Row>
        </Block>

        {/* Second Row - OS Specific Vulnerability Charts */}
        <Block>
          <Row className="g-gs">
            {/* Windows Vulnerabilities */}
            <Col lg="6">
              <PreviewCard>
                <div className="card-inner">
                  <div className="card-title-group align-start mb-3">
                    <div className="card-title">
                      <h6 className="title">Executive Vulnerability Metrics - 25 Day Trend Windows Vulnerabilities</h6>
                    </div>
                  </div>
                  <div className="nk-ck" style={{ height: '300px' }}>
                    <Bar data={windowsVulnData} options={barChartOptions} />
                  </div>
                  <div className="chart-label-group mt-3">
                    <div className="chart-label">Last Updated: 1 hour ago</div>
                  </div>
                </div>
              </PreviewCard>
            </Col>

            {/* Linux Vulnerabilities */}
            <Col lg="6">
              <PreviewCard>
                <div className="card-inner">
                  <div className="card-title-group align-start mb-3">
                    <div className="card-title">
                      <h6 className="title">Executive Vulnerability Metrics - 25 Day Trend Linux Vulnerabilities</h6>
                    </div>
                  </div>
                  <div className="nk-ck" style={{ height: '300px' }}>
                    <Bar data={linuxVulnData} options={barChartOptions} />
                  </div>
                  <div className="chart-label-group mt-3">
                    <div className="chart-label">Last Updated: 1 hour ago</div>
                  </div>
                </div>
              </PreviewCard>
            </Col>
          </Row>
        </Block>

        {/* Vulnerability Publication Age */}
        <Block>
          <Row className="g-gs">
            <Col lg="12">
              <PreviewCard>
                <VulnerabilityCompactTable
                  title="Executive Vulnerability Metrics - Vulnerability Publication Age"
                  data={vulnerabilityPublicationAge}
                  lastUpdated="1 hour ago"
                />
              </PreviewCard>
            </Col>
          </Row>
        </Block>

        {/* Vulnerability Mitigation */}
        <Block>
          <Row className="g-gs">
            <Col lg="12">
              <PreviewCard>
                <VulnerabilityMitigationCompactTable
                  title="Executive Vulnerability Metrics - Vulnerability Mitigation"
                  data={vulnerabilityMitigation}
                  lastUpdated="1 hour ago"
                />
              </PreviewCard>
            </Col>
          </Row>
        </Block>

        {/* Top 10 Most Vulnerable Hosts */}
        <Block>
          <Row className="g-gs">
            <Col lg="12">
              <PreviewCard>
                <HostCompactTable
                  title="Vulnerability Top Ten - Top 10 Most Vulnerable Hosts"
                  data={topVulnerableHosts}
                  lastUpdated="7 minutes ago"
                />
              </PreviewCard>
            </Col>
          </Row>
        </Block>

        {/* Top 10 Previously Mitigated Hosts */}
        <Block>
          <Row className="g-gs">
            <Col lg="12">
              <PreviewCard>
                <HostCompactTable
                  title="Executive Vulnerability Metrics - Top 10 Previously Mitigated Hosts"
                  data={topMitigatedHosts}
                  lastUpdated="7 minutes ago"
                />
              </PreviewCard>
            </Col>
          </Row>
        </Block>
      </Content>
    </>
  );
};

export default VulnerabilityMetrics;
